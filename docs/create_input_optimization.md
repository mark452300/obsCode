# create_input æ–¹æ³•ä¼˜åŒ–æ–‡æ¡£

## æ¦‚è¿°

æœ¬æ–‡æ¡£è¯¦ç»†è¯´æ˜äº†å¯¹ `InputManager.create_input()` æ–¹æ³•çš„ä¼˜åŒ–æ”¹è¿›ï¼ŒåŒ…æ‹¬å¢å¼ºçš„å‚æ•°éªŒè¯ã€é”™è¯¯å¤„ç†å’Œè¿”å›å€¼ç»“æ„ã€‚

## ğŸ”§ **ä¼˜åŒ–å‰åå¯¹æ¯”**

### åŸå§‹ç‰ˆæœ¬çš„é—®é¢˜
1. **å‚æ•°éªŒè¯ä¸å¤Ÿå…¨é¢** - åªæ£€æŸ¥åœºæ™¯å‚æ•°ï¼Œæ²¡æœ‰éªŒè¯è¾“å…¥åç§°å’Œç±»å‹
2. **ç¼ºå°‘é‡å¤æ£€æŸ¥** - ä¸æ£€æŸ¥è¾“å…¥åç§°æ˜¯å¦å·²å­˜åœ¨
3. **é”™è¯¯å¤„ç†ç®€å•** - åªæœ‰åŸºæœ¬çš„å¼‚å¸¸æ•è·
4. **è¿”å›å€¼ä¿¡æ¯æœ‰é™** - åªè¿”å› UUID å’Œåœºæ™¯é¡¹ ID
5. **æ²¡æœ‰è¾“å…¥ç±»å‹éªŒè¯** - ä¸æ£€æŸ¥è¾“å…¥ç±»å‹æ˜¯å¦å—æ”¯æŒ

### ä¼˜åŒ–åçš„æ”¹è¿›
1. âœ… **å…¨é¢çš„å‚æ•°éªŒè¯**
2. âœ… **æ™ºèƒ½é‡å¤æ£€æŸ¥**
3. âœ… **å¢å¼ºçš„é”™è¯¯å¤„ç†**
4. âœ… **ä¸°å¯Œçš„è¿”å›å€¼**
5. âœ… **è¾“å…¥ç±»å‹éªŒè¯**

## ğŸ“‹ **è¯¦ç»†ä¼˜åŒ–å†…å®¹**

### 1. å‚æ•°éªŒè¯å¢å¼º

```python
# æ–°å¢å‚æ•°
check_duplicates: bool = True  # æ˜¯å¦æ£€æŸ¥é‡å¤åç§°

# å¢å¼ºçš„éªŒè¯é€»è¾‘
- æ£€æŸ¥è¾“å…¥åç§°ä¸èƒ½ä¸ºç©º
- æ£€æŸ¥è¾“å…¥ç±»å‹ä¸èƒ½ä¸ºç©º
- éªŒè¯åœºæ™¯å‚æ•°çš„äº’æ–¥æ€§
- å¯é€‰çš„é‡å¤åç§°æ£€æŸ¥
- è¾“å…¥ç±»å‹æ”¯æŒæ€§éªŒè¯
```

### 2. æ™ºèƒ½é‡å¤æ£€æŸ¥

```python
# æ£€æŸ¥è¾“å…¥åç§°æ˜¯å¦å·²å­˜åœ¨
if check_duplicates and self.exists(input_name):
    raise ValueError(f"è¾“å…¥åç§° '{input_name}' å·²å­˜åœ¨")
```

**ç‰¹æ€§ï¼š**
- é»˜è®¤å¯ç”¨é‡å¤æ£€æŸ¥
- å¯é€šè¿‡ `check_duplicates=False` ç¦ç”¨
- ä½¿ç”¨ç°æœ‰çš„ `exists()` æ–¹æ³•è¿›è¡Œæ£€æŸ¥

### 3. è¾“å…¥ç±»å‹éªŒè¯

```python
# éªŒè¯è¾“å…¥ç±»å‹æ˜¯å¦æ”¯æŒ
available_kinds = self.get_input_kinds()
if available_kinds and input_kind not in available_kinds:
    self.logger.warning(f"è¾“å…¥ç±»å‹ '{input_kind}' å¯èƒ½ä¸å—æ”¯æŒ")
```

**ç‰¹æ€§ï¼š**
- æ£€æŸ¥è¾“å…¥ç±»å‹æ˜¯å¦åœ¨æ”¯æŒåˆ—è¡¨ä¸­
- ä¸æ”¯æŒçš„ç±»å‹ä¼šè®°å½•è­¦å‘Šä½†ä»ç„¶å°è¯•åˆ›å»º
- é¿å…å› ç±»å‹æ£€æŸ¥å¤±è´¥è€Œé˜»æ­¢åˆ›å»º

### 4. å¢å¼ºçš„é”™è¯¯å¤„ç†

```python
# å…·ä½“çš„å¼‚å¸¸ç±»å‹è¯†åˆ«
if 'scene' in error_msg and ('not found' in error_msg or 'ä¸å­˜åœ¨' in error_msg):
    raise OBSResourceNotFoundError(f"åœºæ™¯ä¸å­˜åœ¨: {scene_name or scene_uuid}")
elif 'input' in error_msg and ('exists' in error_msg or 'å·²å­˜åœ¨' in error_msg):
    raise ValueError(f"è¾“å…¥åç§° '{input_name}' å·²å­˜åœ¨")
```

**æ”¹è¿›ï¼š**
- è¯†åˆ«ç‰¹å®šçš„ OBS é”™è¯¯ç±»å‹
- æä¾›æ›´æœ‰æ„ä¹‰çš„é”™è¯¯ä¿¡æ¯
- ä½¿ç”¨é€‚å½“çš„å¼‚å¸¸ç±»å‹

### 5. ä¸°å¯Œçš„è¿”å›å€¼ç»“æ„

```python
# ä¼˜åŒ–å‰
return {
    'input_uuid': result.get('inputUuid', ''),
    'scene_item_id': result.get('sceneItemId', 0)
}

# ä¼˜åŒ–å
return {
    'input_uuid': input_uuid,
    'scene_item_id': scene_item_id,
    'input_name': input_name,      # æ–°å¢
    'input_kind': input_kind,      # æ–°å¢
    'success': True                # æ–°å¢
}
```

**æ–°å¢å­—æ®µï¼š**
- `input_name`: è¾“å…¥åç§°
- `input_kind`: è¾“å…¥ç±»å‹
- `success`: åˆ›å»ºæ˜¯å¦æˆåŠŸ

### 6. æ”¹è¿›çš„æ—¥å¿—è®°å½•

```python
# è°ƒè¯•ä¿¡æ¯
self.logger.debug(f"åˆ›å»ºè¾“å…¥è¯·æ±‚å‚æ•°: {request_params}")

# è¯¦ç»†çš„æˆåŠŸä¿¡æ¯
self.logger.info(f"æˆåŠŸåˆ›å»ºè¾“å…¥ '{input_name}' (UUID: {input_uuid}, åœºæ™¯é¡¹ID: {scene_item_id})")

# è­¦å‘Šä¿¡æ¯
self.logger.warning(f"åˆ›å»ºè¾“å…¥ '{input_name}' çš„å“åº”ä¸ºç©ºæˆ–æ— æ•ˆ")
```

## ğŸ§ª **æµ‹è¯•è¦†ç›–**

### æµ‹è¯•ç”¨ä¾‹
1. **åŸºæœ¬åˆ›å»ºåŠŸèƒ½** - éªŒè¯æ­£å¸¸åˆ›å»ºæµç¨‹
2. **å‚æ•°éªŒè¯** - æµ‹è¯•å„ç§æ— æ•ˆå‚æ•°
3. **é‡å¤åç§°æ£€æŸ¥** - æµ‹è¯•é‡å¤æ£€æŸ¥åŠŸèƒ½
4. **è¿”å›å€¼ç»“æ„** - éªŒè¯è¿”å›å€¼çš„å®Œæ•´æ€§
5. **è¾“å…¥ç±»å‹éªŒè¯** - æµ‹è¯•ç±»å‹éªŒè¯åŠŸèƒ½

### æµ‹è¯•ç»“æœ
```
æµ‹è¯•ç»“æœ: 5/5 é€šè¿‡
âœ… åŸºæœ¬åˆ›å»ºåŠŸèƒ½ æµ‹è¯•é€šè¿‡
âœ… å‚æ•°éªŒè¯ æµ‹è¯•é€šè¿‡  
âœ… é‡å¤åç§°æ£€æŸ¥ æµ‹è¯•é€šè¿‡
âœ… è¿”å›å€¼ç»“æ„ æµ‹è¯•é€šè¿‡
âœ… è¾“å…¥ç±»å‹éªŒè¯ æµ‹è¯•é€šè¿‡
```

## ğŸ“– **ä½¿ç”¨ç¤ºä¾‹**

### åŸºæœ¬ä½¿ç”¨
```python
result = obs.inputs.create_input(
    input_name="æˆ‘çš„æ–‡æœ¬æº",
    input_kind="text_gdiplus_v3",
    scene_name="ä¸»åœºæ™¯",
    input_settings={"text": "Hello World!"}
)

if result['success']:
    print(f"åˆ›å»ºæˆåŠŸ: {result['input_uuid']}")
else:
    print("åˆ›å»ºå¤±è´¥")
```

### ç¦ç”¨é‡å¤æ£€æŸ¥
```python
result = obs.inputs.create_input(
    input_name="å¯èƒ½é‡å¤çš„åç§°",
    input_kind="text_gdiplus_v3",
    scene_name="ä¸»åœºæ™¯",
    check_duplicates=False  # ç¦ç”¨é‡å¤æ£€æŸ¥
)
```

### ä½¿ç”¨åœºæ™¯ UUID
```python
result = obs.inputs.create_input(
    input_name="æ–°è¾“å…¥æº",
    input_kind="image_source",
    scene_uuid="scene-uuid-123",
    input_settings={"file": "image.png"}
)
```

## ğŸ¯ **æœ€ä½³å®è·µ**

1. **æ€»æ˜¯æ£€æŸ¥è¿”å›å€¼çš„ success å­—æ®µ**
2. **ä½¿ç”¨æœ‰æ„ä¹‰çš„è¾“å…¥åç§°**
3. **éªŒè¯è¾“å…¥ç±»å‹æ˜¯å¦å—æ”¯æŒ**
4. **é€‚å½“å¤„ç†å¼‚å¸¸æƒ…å†µ**
5. **åœ¨ç”Ÿäº§ç¯å¢ƒä¸­å¯ç”¨é‡å¤æ£€æŸ¥**

## ğŸ”„ **å‘åå…¼å®¹æ€§**

- æ‰€æœ‰åŸæœ‰å‚æ•°ä¿æŒä¸å˜
- æ–°å¢å‚æ•°éƒ½æœ‰é»˜è®¤å€¼
- è¿”å›å€¼ç»“æ„å‘åå…¼å®¹ï¼ˆæ–°å¢å­—æ®µï¼‰
- å¼‚å¸¸ç±»å‹å¯èƒ½æœ‰å˜åŒ–ï¼ˆæ›´å…·ä½“ï¼‰

## ğŸ“ **æ³¨æ„äº‹é¡¹**

1. **è¾“å…¥ç±»å‹éªŒè¯**ï¼šåªæ˜¯è­¦å‘Šï¼Œä¸ä¼šé˜»æ­¢åˆ›å»º
2. **é‡å¤æ£€æŸ¥**ï¼šé»˜è®¤å¯ç”¨ï¼Œå¯ä»¥ç¦ç”¨
3. **é”™è¯¯å¤„ç†**ï¼šæ›´å…·ä½“çš„å¼‚å¸¸ç±»å‹
4. **æ—¥å¿—çº§åˆ«**ï¼šå¢åŠ äº† debug å’Œ warning çº§åˆ«çš„æ—¥å¿—
5. **æ€§èƒ½å½±å“**ï¼šå¢åŠ äº†ä¸€äº›éªŒè¯æ­¥éª¤ï¼Œä½†å½±å“å¾ˆå°

## ğŸš€ **è¿è¡Œæµ‹è¯•**

```bash
# è¿è¡Œä¼˜åŒ–åçš„æµ‹è¯•
py -3.11 tests/test_create_input_optimized.py
```

è¿™äº›ä¼˜åŒ–ä½¿ `create_input` æ–¹æ³•æ›´åŠ å¥å£®ã€ç”¨æˆ·å‹å¥½ï¼Œå¹¶æä¾›äº†æ›´å¥½çš„é”™è¯¯å¤„ç†å’Œè°ƒè¯•ä¿¡æ¯ã€‚
