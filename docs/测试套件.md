# OBS SDK 测试套件

本目录包含 OBS SDK 的完整测试套件，采用模块化设计，避免重复测试。

## 📁 测试文件结构

```
tests/
├── README.md                    # 本文件 - 测试说明
├── run_tests.py                 # 🚀 统一测试运行器（推荐使用）
├── test_scenes.py               # 🎬 场景管理测试
├── test_inputs.py               # 🎵 输入管理测试
└── run_scene_tests.py           # 🎬 场景测试专用运行器（保留兼容性）
```

## 🚀 快速开始

### 运行所有测试（推荐）
```bash
# 使用统一测试运行器
py -3.11 tests/run_tests.py
```

### 运行特定模块测试
```bash
# 只运行场景管理测试
py -3.11 tests/run_tests.py --scenes

# 只运行输入管理测试
py -3.11 tests/run_tests.py --inputs

# 运行示例演示
py -3.11 tests/run_tests.py --examples

# 检查 OBS 连接
py -3.11 tests/run_tests.py --check-connection
```

### 运行单个测试文件
```bash
# 直接运行场景测试
py -3.11 tests/test_scenes.py

# 直接运行输入测试
py -3.11 tests/test_inputs.py
```

## 📋 测试模块说明

### 1. 场景管理测试 (`test_scenes.py`)
**测试内容：**
- ✅ 连接状态检查
- ✅ 场景列表获取
- ✅ 场景创建和删除
- ✅ 场景切换
- ✅ Studio Mode 控制
- ✅ 转场操作
- ✅ 错误处理

**运行方式：**
```bash
py -3.11 tests/run_tests.py --scenes
# 或
py -3.11 tests/test_scenes.py
```

### 2. 输入管理测试 (`test_inputs.py`)
**测试内容：**
- ✅ 输入源列表获取
- ✅ 输入类型列表获取
- ✅ 音频输入识别
- ✅ 静音控制（静音/取消静音/切换）
- ✅ 设置管理
- ✅ 信息摘要
- ✅ 错误处理

**运行方式：**
```bash
py -3.11 tests/run_tests.py --inputs
# 或
py -3.11 tests/test_inputs.py
```

### 3. 统一测试运行器 (`run_tests.py`)
**功能：**
- 🔍 OBS 连接检查
- 🎯 模块化测试执行
- 📊 测试结果汇总
- 🎨 友好的输出格式

**支持的参数：**
- `--scenes`: 运行场景测试
- `--inputs`: 运行输入测试
- `--examples`: 运行示例演示
- `--check-connection`: 检查连接
- `--verbose, -v`: 详细输出

## 🎯 示例演示

示例文件位于 `examples/` 目录：

```
examples/
├── input_kinds_demo.py          # 输入类型列表演示
└── input_kinds_example.py       # 输入类型功能示例（已存在）
```

运行示例：
```bash
py -3.11 tests/run_tests.py --examples
```

## ⚙️ 测试前置条件

### 1. 环境要求
- Python 3.11+
- obs-websocket-py 库

### 2. OBS 配置
1. **启动 OBS Studio**
2. **启用 WebSocket 服务器**：
   - 进入 **工具** → **obs-websocket 设置**
   - 勾选 **启用 WebSocket 服务器**
   - 设置端口（默认：4455）
   - 设置密码（可选）
3. **确保有基本的场景和输入源**

### 3. 连接配置
确保 `obs_sdk/config.py` 中的连接参数正确：
```python
# 默认配置
host = "localhost"
port = 4455
password = ""  # 如果设置了密码
```

## 🔧 故障排除

### 连接失败
```
❌ 连接失败: [Errno 10061] No connection could be made
```
**解决方案：**
1. 确认 OBS Studio 正在运行
2. 检查 WebSocket 服务器是否已启用
3. 验证端口和密码配置

### 模块导入错误
```
ModuleNotFoundError: No module named 'obs_sdk'
```
**解决方案：**
1. 确保在项目根目录运行测试
2. 使用提供的测试运行器：`py -3.11 tests/run_tests.py`

### 测试失败
```
❌ 部分测试失败
```
**解决方案：**
1. 检查 OBS 中是否有足够的场景和输入源
2. 确认 OBS 版本支持相关功能
3. 查看详细错误信息进行针对性修复

## 📊 测试覆盖范围

### 场景管理 (test_scenes.py)
- [x] 基础连接测试
- [x] 场景 CRUD 操作
- [x] Studio Mode 功能
- [x] 转场控制
- [x] 异常处理

### 输入管理 (test_inputs.py)
- [x] 输入源查询
- [x] 输入类型获取
- [x] 静音控制
- [x] 设置管理
- [x] 信息统计
- [x] 错误处理

## 🎉 测试最佳实践

1. **运行顺序**：先运行连接检查，再运行具体测试
2. **测试隔离**：每个测试模块独立运行，互不影响
3. **状态恢复**：测试后自动恢复 OBS 初始状态
4. **错误处理**：完善的异常捕获和错误提示
5. **输出友好**：清晰的测试进度和结果显示

## 🔄 持续集成

可以将测试集成到 CI/CD 流程中：

```bash
# 检查连接（快速）
py -3.11 tests/run_tests.py --check-connection

# 运行所有测试（完整）
py -3.11 tests/run_tests.py
```

---

**推荐使用统一测试运行器 `run_tests.py` 来执行所有测试！** 🚀
